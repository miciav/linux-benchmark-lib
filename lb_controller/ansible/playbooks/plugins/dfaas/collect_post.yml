- name: Collect DFaaS k6 logs
  hosts: dfaas_k6
  gather_facts: false
  become: false

  vars:
    output_root: "{{ output_root | default('./benchmark_results') }}"

  tasks:
    - name: Find k6 logs on generator host
      ansible.builtin.find:
        paths: "{{ k6_workspace_root }}"
        patterns: "k6.log"
        recurse: true
        file_type: file
      register: k6_log_files
      failed_when: false
      changed_when: false

    - name: Fetch k6 logs to controller
      ansible.builtin.fetch:
        src: "{{ item.path }}"
        dest: "{{ output_root }}/logs/k6/{{ inventory_hostname }}/"
        flat: false
      loop: "{{ k6_log_files.files | default([]) }}"
      loop_control:
        label: "{{ item.path | default('') }}"
      failed_when: false
