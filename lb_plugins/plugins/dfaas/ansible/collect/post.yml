- name: Find generator logs on DFaaS k6 host
  ansible.builtin.find:
    paths: "{{ hostvars.get('dfaas_k6', {}).get('k6_workspace_root', '') }}"
    patterns: "k6.log"
    recurse: true
    file_type: file
  register: dfaas_k6_log_files
  failed_when: false
  changed_when: false
  delegate_to: dfaas_k6
  run_once: true
  when:
    - "'dfaas_k6' in hostvars"

- name: Fetch generator logs to controller
  ansible.builtin.fetch:
    src: "{{ item.path }}"
    dest: "{{ output_root | default('./benchmark_results') }}/logs/k6/dfaas_k6/"
    flat: false
  loop: "{{ dfaas_k6_log_files.files | default([]) }}"
  loop_control:
    label: "{{ item.path | default('') }}"
  failed_when: false
  delegate_to: dfaas_k6
  run_once: true
  when:
    - "'dfaas_k6' in hostvars"
